using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

public class UI : MonoBehaviour
{

    public enum UpgradeName
    {
        UpgradeAttackPower = 0,
        UpgradeSkillCoolTimeDown = 1,
        ExplosionRangeUp = 2,
        MaxHealthUp = 3,
        TransfusionUp = 4,
        DecreaseCoffeine = 5
    }

    private float hp;     // HP정보를 출력할 텍스트

    [SerializeField]
    private Slider hpSlider;
    [SerializeField]
    private TextMeshProUGUI textQCoolTime;     // Q스킬 쿨타임을 출력할 텍스트

    [SerializeField]
    private TextMeshProUGUI textScore;     // 점수 쿨타임을 출력할 텍스트

    [SerializeField]
    private Slider coffeineSlider;

    [SerializeField]
    private TextMeshProUGUI textMoney;     // 돈을 출력할 텍스트
    [SerializeField]
    private GameObject Panel;       // 카페인이 감소할수록 어두워지는 배경
    private Image PanelImage;

    [SerializeField]
    private Image qImage;

    [SerializeField]
    private Player player;

    [SerializeField]
    private GameObject Shop; //상점(스크롤바)을 출력

    [Header("업그레이드 돈 표시")]
    [SerializeField]
    private TextMeshProUGUI textUpgradeDamage;     // 데미지 업 비용 텍스트
    [SerializeField]
    private TextMeshProUGUI textUpgradeSkillCoolDown;     // 스킬 쿨타임 감소 비용 텍스트
    [SerializeField]
    private TextMeshProUGUI textUpgradeExplosionRangeUp;     // 폭발 범위 업 비용 텍스트
    [SerializeField]
    private TextMeshProUGUI textUpgradeMaxHealth;     // 최대체력 업 비용 텍스트
    [SerializeField]
    private TextMeshProUGUI textUpgradeTransfusion;     // 흡혈량 증가 비용 텍스트
    [SerializeField]
    private TextMeshProUGUI textDecreaseCoffeine;     // 카페인 감소량 감소 비용 텍스트


    bool isOpen = false; // 업그레이드 창 ON/OFF

    
    private void Awake()
    {
        player = GameObject.FindGameObjectWithTag("Player").GetComponent<Player>();
        PanelImage = Panel.GetComponent<Image>();
        Shop.SetActive(false);

    }
    // Update is called once per frame
    void Update()
    {
        SetHPValue();
        SetCoffeineValue();
        SetQCoolValue();
        textScore.text = "Score : " + player.score.ToString();
        textMoney.text = "Money : " + player.Money.ToString();
        PanelImage.color = new Color(0, 0, 0, (100-player.coffeine)/100);


        // 업그레이드 텍스트 업데이트
        textUpgradeDamage.text = player.needMoney[(int)UpgradeName.UpgradeAttackPower].ToString();
        textUpgradeExplosionRangeUp.text = player.needMoney[(int)UpgradeName.ExplosionRangeUp].ToString();
        textUpgradeMaxHealth.text = player.needMoney[(int)UpgradeName.MaxHealthUp].ToString();
        textUpgradeSkillCoolDown.text = player.needMoney[(int)UpgradeName.UpgradeSkillCoolTimeDown].ToString();
        textUpgradeTransfusion.text = player.needMoney[(int)UpgradeName.TransfusionUp].ToString();
        textDecreaseCoffeine.text = player.needMoney[(int)UpgradeName.DecreaseCoffeine].ToString();

        if (Input.GetKeyDown(KeyCode.P))
        {
            if (!isOpen)
            {
                Shop.SetActive(true);
                player.isShoping = true;
                isOpen = true;
                Time.timeScale = 0;
            }
            else
            {
                Shop.SetActive(false);
                player.isShoping = false;
                isOpen = false;
                Time.timeScale = 1;
            }
        }
    }

    private void SetQCoolValue()
    {
        qImage.fillAmount = (player.CurQCoolTime / player.explosionCoolTime);
    }

    public void SetHPValue()
    {
        hpSlider.value = player.CurHP/player.MaxHP;
    }  

    public void SetCoffeineValue()
    {
        coffeineSlider.value = player.coffeine / 100;
    }
}
